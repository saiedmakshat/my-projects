pipeline {
    agent {
        label 'master-node'
    }
    environment {
        SCANNER_HOME= tool 'sonar-scanner'
    }
    tools {
        // Reference the NodeJS installation configured in Global Tool Configuration
        nodejs 'node-18' // Use the name you assigned earlier
    }
    stages {
        // stage('Git Checkout') {
        //     steps {
        //         git branch: 'main', changelog: false, credentialsId:
        //         'github', poll: false, url:
        //         'https://github.com/saiedmakshat/my-projects.git'
        //     }
        // }
        stage('npm install') {
            steps {
                dir('Docker-Projects/angular/expense-tracker-main') {
                    sh 'npm install'
                }
            }
        }
        stage('npm build') {
            steps {
                dir('Docker-Projects/angular/expense-tracker-main') {
                    sh 'npm run build --prod'
                }
            }
        }
//        stage('OWASP Scan') {
//            steps {
//                dir('Docker-Projects/angular/expense-tracker-main') {
//                    dependencyCheck additionalArguments: ' --scan ./ --format XML --format HTML', odcInstallation: 'DP'
//                    dependencyCheckPublisher pattern: '**/dependency-check-report.xml'
//                }
//            }
//        }
        stage('SonarQube') {
            steps {
               dir('Docker-Projects/angular/expense-tracker-main') { 
                withSonarQubeEnv('sonar-server') {
                    sh '$SCANNER_HOME/bin/sonar-scanner -Dsonar-ProjectName=expense-tracker-${JOB_NAME}-${BUILD_NUMBER} -Dsonar.sources=. -Dsonar.projectKey=expense-tracker'
                }}
            }
        }
}
}